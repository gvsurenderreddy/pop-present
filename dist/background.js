function createUrl(e,t){return e.substring(0,e.lastIndexOf("/"))+t}function createTab(e,t){chrome.tabs.create({windowId:e,url:t.url,active:!0},null),chrome.windows.update(e,{focused:!0},null),chrome.tabs.remove(t.id)}function createPresent(e){chrome.system.display.getInfo(function(t){chrome.windows.create({type:"normal",url:["https"+urlsGoogle[6].replace(/\*/g,"")+"google.com",e.url],top:0,left:0,width:t[0].bounds.width,height:t[0].bounds.height},function(e){setPresentId(e.id)}),chrome.tabs.remove(e.id)})}function findPresent(e){setPresentId(-1),chrome.tabs.query({url:[urlsGoogle[6],urlsGoogle[7]]},function(t){t.forEach(function(t){chrome.windows.update(t.windowId,{drawAttention:!0}),setPresentId(t.windowId),chrome.tabs.move(t.id,{windowId:t.windowId,index:0},null),e&&e(t,present)})})}function onSelected(e){chrome.tabs.query({lastFocusedWindow:!0,active:!0},function(t){"open-window"===e.menuItemId?(t[0].url=toggleSlidePresentMode(t[0].url),chrome.windows.create({type:"popup",url:t[0].url},null)):"open-present"===e.menuItemId?(t[0].url=toggleSlidePresentMode(t[0].url),-1===present?createPresent(t[0]):createTab(present,t[0])):"add-present"===e.menuItemId?-1===present?createTab(t[0].windowId,{id:null,url:"https"+urlsGoogle[6].replace(/\*/g,"")+"google.com"},function(){findPresent()}):chrome.tabs.query({currentWindow:!0},function(e){e.forEach(function(e){e.pinned===!1&&createTab(present,e)})}):"edit-present"===e.menuItemId&&chrome.tabs.update(t[0].id,{url:toggleSlideEditPresent(t[0].url)},null)})}function onRemove(e){e===present&&setPresentId(-1)}function setPresentId(e){present=e,chrome.contextMenus.update("open-present",{title:chrome.i18n.getMessage(-1===e?"menuOpenPresent":"menuOpenPresentAlt")},null)}function toggleSlidePresentMode(e){return e.match(/presentation/)?createUrl(e,"?hl=en&ui=2&chrome=false&rm=minimal"):e}function toggleSlideEditPresent(e){var t=e.substr(e.lastIndexOf("/")),n=-1!=t.indexOf("present");return chrome.contextMenus.update("edit-present",{title:chrome.i18n.getMessage(n?"menuEditPresentAlt":"menuEditPresent")},null),n?createUrl(e,"/edit"):createUrl(e,"?hl=en&ui=2&chrome=false&rm=minimal")}function getTabUrl(e){return chrome.tabs.getSelected(null,function(t){return e&&e(t.url),t.url})}var present=-1,urls=["file://*","http://*/*","https://*/*"],urlsGoogle=["*://docs.google.com/*","*://docs.google.com/a/google.com/*","*://docs.google.com/presentation/d/*","*://docs.google.com/a/google.com/presentation/d/*","*://spec.googleplex.com/*","*://folio.googleplex.com/*","*://plus.google.com/hangouts/_/present/*","*://plus.google.com/hangouts/*"],parent=chrome.contextMenus.create({title:chrome.i18n.getMessage("extName"),documentUrlPatterns:urls}),item1=chrome.contextMenus.create({type:"normal",id:"open-window",title:chrome.i18n.getMessage("menuOpenWindow"),parentId:parent}),item2=chrome.contextMenus.create({type:"normal",id:"open-present",title:chrome.i18n.getMessage("menuOpenPresent"),parentId:parent}),separator1=chrome.contextMenus.create({type:"separator",parentId:parent}),item3=chrome.contextMenus.create({type:"normal",id:"add-present",title:chrome.i18n.getMessage("menuAddPresent"),parentId:parent,enabled:!0}),separator2=chrome.contextMenus.create({type:"separator",parentId:parent,documentUrlPatterns:[urlsGoogle[2],urlsGoogle[3]]}),item4=chrome.contextMenus.create({type:"normal",id:"edit-present",title:chrome.i18n.getMessage("menuEditPresent"),parentId:parent,documentUrlPatterns:[urlsGoogle[2],urlsGoogle[3]]});chrome.contextMenus.onClicked.addListener(function(e,t){onSelected(e,t)}),chrome.windows.onRemoved.addListener(function(e){findPresent(),onRemove(e)}),chrome.tabs.onRemoved.addListener(function(e,t){findPresent(),onRemove(t)}),chrome.tabs.onActivated.addListener(function(){findPresent(),getTabUrl(toggleSlideEditPresent)}),chrome.tabs.onUpdated.addListener(function(){findPresent(),getTabUrl(toggleSlideEditPresent)});